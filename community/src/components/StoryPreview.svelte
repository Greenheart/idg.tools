<script lang="ts">
    import { truncateText } from '$lib/utils'
    import { getTag } from '$shared/content-utils'
    import type { Story, CommunityContent } from '$shared/types'
    import Heading from '$shared/components/Heading.svelte'
    import Link from '$shared/components/Link.svelte'
    import Tags from './Tags.svelte'

    export let story: Story
    export let content: CommunityContent

    $: intro = truncateText(story.intro ?? story.story, 300)

    let tags = story.tags.map((tagId) => getTag(tagId, content))
</script>

<Link
    href={`/stories/${story.link}`}
    variant="black"
    class="group grid p-2 font-normal text-stone-50 no-underline"
>
    <div class="grid aspect-[3/2] overflow-hidden rounded-lg">
        <img
            src={story.image}
            alt={story.imageAlt}
            class="transform-gpu rounded-lg object-fill shadow-lg transition-transform duration-300 group-hover:scale-105"
        />
    </div>
    <Heading class="py-2 group-hover:underline">{story.title}</Heading>
    <div class="flex items-center pb-2">
        <span>{new Date(story.publishedAt).toLocaleDateString('sv-SE')}</span>
        {#if tags.length}
            <span class="px-1 md:px-2">&middot;</span>
            <Tags {tags} visible={3} inverted />
        {/if}
    </div>
    <p>{intro}</p>
</Link>
