<script lang="ts">
    import { getSkill } from '$shared/content-utils'
    import type { ToolsContent, Tool } from '$shared/types'
    import { getColor } from '$lib/utils'
    import { globalState } from '$lib/global-state.svelte'

    interface Props {
        tool: Tool
        visible: number
        content: ToolsContent
        class?: string
    }

    let { tool, visible, content, class: className = '' }: Props = $props()

    let mostRelevantSkills = $derived(
        tool.relevancy
            .filter(
                globalState.selectedSkills.length
                    ? ({ skill }) => globalState.selectedSkills.includes(skill)
                    : () => true,
            )
            .slice(0, visible),
    )
</script>

<div class={['flex flex-wrap items-start gap-1 pr-[29px] text-sm', className]}>
    {#each mostRelevantSkills as relevancy}
        {@const skill = getSkill(relevancy.skill, content)}
        {@const color = getColor(relevancy.skill)}
        <span class={['px-2 py-1 text-white', color]}>
            {skill.name}
        </span>
    {/each}
    {#if mostRelevantSkills.length < tool.relevancy.length}
        <span class="self-center">+{tool.relevancy.length - mostRelevantSkills.length}</span>
    {/if}
</div>
